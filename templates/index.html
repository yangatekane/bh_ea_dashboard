<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BH-EA | Borehole Analytics Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <h1>Borehole Exploration / Surveying Analytics (BH-EA)</h1>
    <h3>Cloud Run Impact Dashboard</h3>
  </header>

  <!-- ğŸ§® Threshold Controls -->
  <form id="thresholdForm" method="POST" action="/" style="margin-bottom:20px;">
    <fieldset style="border:1px solid #ccc;padding:12px;border-radius:10px;background:#f8fafc;">
      <legend style="font-weight:bold;color:#003366;">Adjust Thresholds (Goldilocks / Trouble Zones)</legend>
      <div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;">
        <label>Goldilocks Yield &gt;
          <input type="number" step="0.1" name="YIELD_GOLD_MIN" value="{{ yield_gold_min }}" style="width:70px;">
        </label>
        <label>Cost &lt;
          <input type="number" step="100" name="COST_GOLD_MAX" value="{{ cost_gold_max }}" style="width:90px;">
        </label>
        <label style="margin-left:15px;">Trouble Yield &lt;
          <input type="number" step="0.1" name="YIELD_TROUBLE_MAX" value="{{ yield_trouble_max }}" style="width:70px;">
        </label>
        <label>Cost &gt;
          <input type="number" step="100" name="COST_TROUBLE_MIN" value="{{ cost_trouble_min }}" style="width:90px;">
        </label>
        <button type="submit" class="btn btn-primary" style="margin-left:12px;background:#003366;color:white;padding:5px 12px;border:none;border-radius:5px;cursor:pointer;">
          Apply
        </button>
      </div>
    </fieldset>
  </form>

  <section id="upload">
    <form method="POST" enctype="multipart/form-data">
      <div class="row">
        <label>Upload BH-EA CSV dataset:</label>
        <input type="file" name="file" accept=".csv">
      </div>
      <div class="row">
        <label>Upload ERT-I raw data (.dat / .xyz / .csv grid):</label>
        <input type="file" name="ert_data" accept=".dat,.xyz,.csv">
      </div>
      <div class="row">
        <label>Upload ERT-I image (.png / .jpg):</label>
        <input type="file" name="ert_image" accept=".png,.jpg,.jpeg">
      </div>
      <button type="submit">Upload & Refresh</button>
    </form>
    {% if message %}<p class="message">{{ message }}</p>{% endif %}
  </section>

  <section id="kpis">
    <div class="card">ğŸ’§ Total Boreholes: <strong>{{ total_bh }}</strong></div>
    <div class="card">âš™ï¸ Average Yield: <strong>{{ avg_yield }}</strong> L/s</div>
    <div class="card">ğŸ’° Average Cost: <strong>${{ avg_cost }}</strong></div>
    <div class="card">ğŸ“‰ Projected Savings: <strong>${{ proj_savings }}</strong></div>
    <div class="card">ğŸŒŠ Avg Transmissivity: <strong>{{ avg_transmissivity }}</strong> mÂ²/day</div>
    <div class="card">ğŸ§± Avg Storage Coefficient: <strong>{{ avg_storage }}</strong></div>
    <div class="card">ğŸ—ï¸ Avg Monthly Volume: <strong>{{ avg_volume }}</strong> mÂ³/month</div>
  </section>

  <section id="graph">{{ plot_html | safe }}</section>

  {% if ert_processed_img_url %}
    <section id="ert">
      <h3>ERT Inversion / Pseudo-Section</h3>
      <img src="{{ ert_processed_img_url }}" alt="ERT Result" style="max-width:80%; border-radius:10px;">
      {% if ert_processed_csv_url %}
        <p><a href="{{ ert_processed_csv_url }}">Download ERT model CSV</a></p>
      {% endif %}
    </section>
  {% elif ert_uploaded_img_url %}
    <section id="ert">
      <h3>ERT-I Image Preview</h3>
      <img src="{{ ert_uploaded_img_url }}" alt="ERT Upload" style="max-width:80%; border-radius:10px;">
    </section>
  {% endif %}

  <footer>
    <p>Powered by Google Cloud Run | YGE BHI (Pty) Ltd Â© 2025</p>
  </footer>
</body>
</html>
